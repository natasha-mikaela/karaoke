<mat-toolbar color="primary">
  <span>Karaok√™ üé§</span>
</mat-toolbar>

<div class="container">

  <!-- V√çDEO -->
  <mat-card>
    <mat-card-title>Carregar v√≠deo</mat-card-title>

    <input
      type="file"
      accept="video/*,.mp4"
      (change)="onVideoSelected($event)"
    />

    <video
      #player
      [src]="videoUrl"
      controls
      style="width:100%; margin-top:12px; background:black"
      (ended)="onVideoEnded()"
    ></video>
  </mat-card>

  <!-- MICROFONE -->
  <mat-card>
    <mat-card-title>Microfone</mat-card-title>

    <div class="row">
      <button mat-raised-button color="primary" (click)="enableMic()">
        <mat-icon>mic</mat-icon>
        Ativar microfone
      </button>

      <button
        mat-raised-button
        color="accent"
        (click)="toggleMonitor()"
      >
        <mat-icon>volume_up</mat-icon>
        <!-- {{ audio.monitorOn ? 'Monitor ON' : 'Monitor OFF' }} -->
      </button>
    </div>

    <p><b>N√≠vel:</b> {{ micLevel | number:'1.3-3' }}</p>

    <mat-progress-bar
      mode="determinate"
      [value]="micLevel * 100"
    ></mat-progress-bar>

    <mat-slider
      min="0"
      max="1"
      step="0.01"
      [(ngModel)]="monitorVolume"
      (input)="updateMonitorVolume()"
    >
      <input matSliderThumb />
    </mat-slider>

    <small>Volume retorno: {{ monitorVolume | number:'1.2-2' }}</small>
  </mat-card>

  <!-- CONFIGURA√á√ÉO -->
  <mat-card>
    <mat-card-title>Configura√ß√£o do Microfone</mat-card-title>

    <div class="grid">

      <div>
        <label>Silence RMS</label>
        <mat-slider
          min="0.001"
          max="0.08"
          step="0.001"
          [(ngModel)]="cfg.silenceRms"
          (change)="rankingSvc.saveConfig(cfg)"
        >
          <input matSliderThumb />
        </mat-slider>
        <small>{{ cfg.silenceRms | number:'1.3-3' }}</small>
      </div>

      <div>
        <label>Too Loud RMS</label>
        <mat-slider
          min="0.02"
          max="0.4"
          step="0.005"
          [(ngModel)]="cfg.tooLoudRms"
          (change)="rankingSvc.saveConfig(cfg)"
        >
          <input matSliderThumb />
        </mat-slider>
        <small>{{ cfg.tooLoudRms | number:'1.3-3' }}</small>
      </div>

      <div>
        <label>Clip Peak</label>
        <mat-slider
          min="0.8"
          max="0.999"
          step="0.001"
          [(ngModel)]="cfg.clipPeak"
          (change)="rankingSvc.saveConfig(cfg)"
        >
          <input matSliderThumb />
        </mat-slider>
        <small>{{ cfg.clipPeak | number:'1.3-3' }}</small>
      </div>

      <div>
        <label>Pontos / segundo</label>
        <mat-slider
          min="1"
          max="80"
          step="1"
          [(ngModel)]="cfg.maxPtsPerSec"
          (change)="rankingSvc.saveConfig(cfg)"
        >
          <input matSliderThumb />
        </mat-slider>
        <small>{{ cfg.maxPtsPerSec }}</small>
      </div>

      <div>
        <label>Penalidade / segundo</label>
        <mat-slider
          min="0"
          max="60"
          step="1"
          [(ngModel)]="cfg.clipPenaltyPerSec"
          (change)="rankingSvc.saveConfig(cfg)"
        >
          <input matSliderThumb />
        </mat-slider>
        <small>{{ cfg.clipPenaltyPerSec }}</small>
      </div>

    </div>

    <button
      mat-stroked-button
      color="warn"
      (click)="cfg = rankingSvc.DEFAULTS; rankingSvc.saveConfig(cfg)"
    >
      Restaurar padr√£o
    </button>
  </mat-card>

  <!-- SCORE -->
<mat-card>
    <mat-card-title>Pontua√ß√£o</mat-card-title>

    <h2>{{ score }}</h2>

    <button mat-raised-button color="warn" (click)="resetScore()">
      Zerar score
    </button>

    <p class="muted">
      V√≠deo: {{ videoState }} |
      Tempo: {{ videoTime | number:'1.1-1' }}
    </p>
  </mat-card>

  <!-- RANKING -->
  <mat-card>
    <mat-card-title>Ranking</mat-card-title>

    <button mat-stroked-button color="warn" (click)="clearRanking()">
      Limpar ranking
    </button>

    <table mat-table [dataSource]="ranking" class="mat-elevation-z2">

      <ng-container matColumnDef="pos">
        <th mat-header-cell *matHeaderCellDef>#</th>
        <td mat-cell *matCellDef="let row; index as i">{{ i + 1 }}</td>
      </ng-container>

      <ng-container matColumnDef="music">
        <th mat-header-cell *matHeaderCellDef>M√∫sica</th>
        <td mat-cell *matCellDef="let row">{{ row.music }}</td>
      </ng-container>

      <ng-container matColumnDef="score">
        <th mat-header-cell *matHeaderCellDef>Score</th>
        <td mat-cell *matCellDef="let row">{{ row.score }}</td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>Data</th>
        <td mat-cell *matCellDef="let row">{{ row.date }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['pos','music','score','date']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['pos','music','score','date']"></tr>

    </table>
  </mat-card>

</div>
